{
  "$schema": "https://vega.github.io/schema/vega/v4.json",
  "title": "Team Filter with Apply Button",
  "signals": [
    {
      "name": "selected_team",
      "value": "",  // 默认未选择
      "bind": {
        "input": "select",
        "options": ["", "Team A", "Team B", "Team C"],
        "name": "Select Team:"
      }
    },
    {
      "name": "team_to_svcs",  // team 到 svc 的映射
      "value": {
        "Team A": ["svc_a1", "svc_a2"],
        "Team B": ["svc_b1", "svc_b2", "svc_b3"],
        "Team C": ["svc_c1"]
      }
    },
    {
      "name": "trigger_filter",  // 点击按钮后执行添加 filter 的信号
      "on": [
        {
          "events": { "type": "click", "markname": "apply_button" },
          "update": "selected_team && team_to_svcs[selected_team] ? kibanaAddFilter('failed_svc', team_to_svcs[selected_team], true) : null"
        }
      ]
    }
  ],

  "marks": [
    {
      "name": "apply_button",
      "type": "rect",
      "encode": {
        "enter": {
          "x": { "value": 250 },
          "y": { "value": 10 },
          "width": { "value": 120 },
          "height": { "value": 30 },
          "fill": { "value": "#2a74d6" },
          "stroke": { "value": "#1f5bb5" },
          "cursor": { "value": "pointer" }
        },
        "hover": {
          "fill": { "value": "#1f5bb5" }
        }
      }
    },
    {
      "type": "text",
      "encode": {
        "enter": {
          "x": { "value": 310 },
          "y": { "value": 25 },
          "align": { "value": "center" },
          "baseline": { "value": "middle" },
          "text": { "value": "Apply Changes" },
          "fill": { "value": "white" },
          "fontSize": { "value": 14 },
          "fontWeight": { "value": "bold" }
        }
      }
    }
  ]
}
